<!doctype html>
<html>
<head>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
<script src="http://code.jquery.com/jquery-latest.js"></script>
</head>
<body>

<style>
  #data {
    text-align: center;
    height: 20px;
  }

  #mapid {
    top: 50px;
    height: 500px;
  }
</style>


<div id="data">nothing received yet</div>

<div id="mapid"></div>

<script>

var mymap = L.map('mapid').setView([39, -98], 4);

/* Basemap Layers */
L.tileLayer("https://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png", {
  maxZoom: 19,
  subdomains: ["otile1-s", "otile2-s", "otile3-s", "otile4-s"],
  attribution: 'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="https://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA.'
}).addTo(mymap);


var mymarkers = [];

function updateMarkers(newMarker) {
    mymarkers.push(newMarker);
    newMarker.addTo(mymap);

    if (mymarkers.length > 100) {
        oldMarker = mymarkers.shift();
        mymap.removeLayer(oldMarker);
    }
}


if (!!window.EventSource) {
  var source = new EventSource('http://127.0.0.1:5000/tweets');
  source.onmessage = function(e) {
    var response = JSON.parse(e.data);
    $("#data").text(response.tweet);
    var marker = L.marker([response.coordinates[1],
                           response.coordinates[0]]);
    updateMarkers(marker);
  }
}

</script>
</body>
</html>
